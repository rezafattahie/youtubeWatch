<!-- Overlay -->
@if (isOpen()) {
<div class="fixed top-0 left-0 h-screen w-screen bg-black/60 z-40" (click)="close()"></div>
}

<!-- Drawer -->
<div
  class="absolute right-0 -mt-6 bottom-auto h-auto overflow-y-auto max-h-screen 2xl:max-h-200 w-74 mx-3 bg-sky-50 text-slate-700 shadow-2xl rounded-xl z-50 transition-all duration-200 ease-in-out"
  [class]="isOpen() ? 'top-auto' : '-translate-y-full -top-20'"
>
  <div class="p-4 flex flex-col h-full">
    @if(title()) {
    <h2 class="text-lg font-semibold mb-3">{{ title() }}</h2>
    } @if (form() && fields().length > 0) {
    <form [formGroup]="form()!" class="flex flex-col gap-3 flex-1 overflow-auto px-1">
      <!-- Generate inputs -->
      @for (field of fields(); track field.name) { @switch (field.type) {

      <!-- TEXT -->
      @case ('text') {
      <div class="flex flex-col" [hidden]="field.hidden">
        <label class="text-xs ml-2" [ngClass]="field.disabled ? 'text-gray-500' : ''">{{
          field.label
        }}</label>
        <div class="flex items-center gap-1">
          @if (field.iconConfig) {
          <app-icon [name]="field.iconConfig.name" [class]="field.iconConfig.class"></app-icon>}
          <input
            type="text"
            [formControlName]="field.name"
            [mask]="field.mask"
            [placeholder]="field.placeholder || ''"
            [ngClass]="field.disabled ? 'text-gray-500 bg-gray-100 cursor-not-allowed' : ''"
            class="w-full placeholder-gray-400 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>
      }

      <!-- EMAIL -->
      @case ('email') {
      <div class="flex flex-col" [hidden]="field.hidden">
        <label class="text-sm ml-2" [ngClass]="field.disabled ? 'text-gray600' : ''">{{
          field.label
        }}</label>
        <input
          type="email"
          [formControlName]="field.name"
          [ngClass]="field.disabled ? 'text-gray-500 bg-gray-100 cursor-not-allowed' : ''"
          class="w-full placeholder-gray-400 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500"
        />
      </div>
      }

      <!-- SELECT -->
      @case ('select') {
      <div class="flex flex-col" [hidden]="field.hidden">
        <label class="text-sm ml-2" [ngClass]="field.disabled ? 'text-gray600' : ''">{{
          field.label
        }}</label>
        <select
          [formControlName]="field.name"
          [ngClass]="field.disabled ? 'text-gray-500 bg-gray-100 cursor-not-allowed' : ''"
          class="w-full placeholder-gray-400 border border-gray-300 rounded-md p-2 focus:ring-2 focus:ring-blue-500"
        >
          @for (option of field.options; track $index) {
          <option [value]="option.value" [selected]="option.selected">{{ option.label }}</option>
          }
        </select>
      </div>
      }

      <!-- CHECKBOX -->
      @case ('checkbox') {
      <div class="flex items-center gap-2" [hidden]="field.hidden">
        <input
          type="checkbox"
          [formControlName]="field.name"
          [ngClass]="field.disabled ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'"
          class="w-4 h-4 accent-blue-600"
        />
        <label
          class="text-sm font-medium"
          [ngClass]="field.disabled ? 'text-gray-500 cursor-not-allowed' : 'cursor-pointer'"
        >
          {{ field.label }}
        </label>
      </div>
      } }
      <!-- end switch -->

      }
      <!-- end for -->

      <!-- consolidated error messages -->
      <div class="mt-3">
        @for (field of fields(); track field.name) { @if (form()?.get(field.name)?.touched &&
        form()?.get(field.name)?.invalid) { @if(field.label) {
        <p class="text-sky-700 text-xs">&bullet; Check the value of "{{ field.label }}"</p>
        } } }
      </div>

      <!-- buttons -->
      @if(btnText()) {
      <div class="mt-auto flex flex-col justify-center gap-2 pt-2">
        <button
          type="button"
          class="px-3 py-1.5 bg-indigo-600 text-indigo-100 rounded-md hover:bg-indigo-700"
          [ngClass]="
            form()?.touched && form()?.invalid
              ? 'bg-zinc-400 hover:bg-zinc-400 text-zinc-200 cursor-not-allowed'
              : 'cursor-pointer'
          "
          (click)="submitForm()"
          [disabled]="form()?.touched && form()?.invalid"
        >
          {{ btnText() }}
        </button>
        <button
          type="button"
          class="px-3 py-1.5 bg-rose-500 text-rose-100 rounded-md hover:bg-rose-600 cursor-pointer"
          (click)="close()"
        >
          Cancel
        </button>
      </div>
      }
    </form>
    } @else {
    <ng-content></ng-content>
    }
  </div>
</div>
